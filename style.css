/* =================== THEME TOKENS =================== */
:root{
  --t-dur: 360ms;

  /* ORIGINAL (morado/azul) */
  --bg-start:#090a16; --bg-mid:#241a4a; --bg-end:#432880;
  --surface-0:#0e0f1c; --surface-1:#15132b; --surface-2:#1d1b3a; --surface-3:#2b254f;
  --text:#f1f5f9; --text-muted:#d8ccff;
  --border:#7f5af066; --border-soft:#7f5af040; --shadow:0 10px 30px rgba(0,0,0,.35);
  --primary:#a855f7; --primary-strong:#7c3aed; --accent:#60a5fa; --accent-2:#38bdf8;

  --bubble-assistant-bg:var(--surface-2);
  --bubble-assistant-borde:#a78bfa;
  --bubble-user-bg:color-mix(in srgb, var(--primary) 18%, transparent);
  --bubble-user-borde:var(--primary-strong);

  --title-1:#f472b6; --title-2:#c4b5fd; --title-3:#60a5fa;

  --btn:var(--primary-strong); --btn-hov:color-mix(in srgb, var(--btn) 88%, white 12%);
  --glow-1: rgba(167,139,250,.28); --glow-2: rgba(96,165,250,.18);

  /* === NUEVO: tokens del cuadro de texto (suaves por tema) === */
  --composer-bg: color-mix(in srgb, var(--surface-2) 80%, white 20%);
  --composer-border: var(--border);
  --composer-text: var(--text);
  --composer-placeholder: color-mix(in srgb, var(--text) 55%, transparent);
}

/* AZUL */
body.theme-blue{
  --bg-start:#0b1220; --bg-mid:#162447; --bg-end:#2c2a86;
  --surface-0:#0e1322; --surface-1:#131a2f; --surface-2:#1a223a; --surface-3:#212a45;
  --text:#f1f5f9; --text-muted:#c7d2fe;
  --border:#3a5aa6aa; --border-soft:#3a5aa666;
  --primary:#60a5fa; --primary-strong:#2563eb; --accent:#22d3ee; --accent-2:#a78bfa;
  --bubble-assistant-bg:var(--surface-2); --bubble-assistant-borde:var(--accent-2);
  --bubble-user-bg:color-mix(in srgb, var(--primary) 18%, transparent);
  --bubble-user-borde:var(--primary-strong);
  --title-1:#22d3ee; --title-2:#60a5fa; --title-3:#a78bfa;
  --btn:var(--primary-strong); --btn-hov:color-mix(in srgb, var(--btn) 88%, white 12%);
  --glow-1: rgba(96,165,250,.28); --glow-2: rgba(34,211,238,.20);

  /* input más suave para azul */
  --composer-bg: color-mix(in srgb, #1a223a 70%, #ffffff 30%);
  --composer-border: color-mix(in srgb, var(--primary-strong) 30%, transparent);
  --composer-placeholder: color-mix(in srgb, #c7d2fe 65%, transparent);
}

/* GRIS */
body.theme-gray{
  --bg-start:#0b0b0f; --bg-mid:#1c1d27; --bg-end:#2c2d38;
  --surface-0:#0c0d12; --surface-1:#151721; --surface-2:#1d2130; --surface-3:#24283a;
  --text:#eef2f7; --text-muted:#cbd5e1;
  --border:#6b7280aa; --border-soft:#6b728066;
  --primary:#a855f7; --primary-strong:#7c3aed; --accent:#38bdf8; --accent-2:#c084fc;
  --bubble-assistant-bg:var(--surface-2); --bubble-assistant-borde:#a78bfa;
  --bubble-user-bg:color-mix(in srgb, var(--primary) 20%, transparent);
  --bubble-user-borde:var(--primary-strong);
  --title-1:#a855f7; --title-2:#c084fc; --title-3:#60a5fa;
  --btn:var(--primary-strong); --btn-hov:color-mix(in srgb, var(--primary-strong) 88%, white 12%);
  --glow-1: rgba(168,85,247,.28); --glow-2: rgba(96,165,250,.20);

  --composer-bg: color-mix(in srgb, #1d2130 68%, #ffffff 32%);
  --composer-border: color-mix(in srgb, #7c3aed 28%, #ffffff 0%);
  --composer-placeholder: color-mix(in srgb, #cbd5e1 70%, transparent);
}

/* ROJO */
body.theme-red{
  --bg-start:#14060a; --bg-mid:#2a0f1f; --bg-end:#4a1630;
  --surface-0:#11060b; --surface-1:#1a0a12; --surface-2:#26111e; --surface-3:#321526;
  --text:#fdeef3; --text-muted:#fecdd3;
  --border:#9f123966; --border-soft:#9f123944;
  --primary:#f43f5e; --primary-strong:#e11d48; --accent:#fb7185; --accent-2:#f472b6;
  --bubble-assistant-bg:var(--surface-2); --bubble-assistant-borde:#fb7185;
  --bubble-user-bg:color-mix(in srgb, var(--primary) 18%, transparent);
  --bubble-user-borde:var(--primary-strong);
  --title-1:#fb7185; --title-2:#f43f5e; --title-3:#f472b6;
  --btn:var(--primary-strong); --btn-hov:color-mix(in srgb, var(--primary-strong) 88%, white 12%);
  --glow-1: rgba(244,63,94,.28); --glow-2: rgba(244,114,182,.20);

  --composer-bg: color-mix(in srgb, #26111e 68%, #ffffff 32%);
  --composer-border: color-mix(in srgb, #f43f5e 28%, transparent);
  --composer-placeholder: color-mix(in srgb, #fecdd3 70%, transparent);
}

/* ARCOÍRIS (fondo vibrante) */
body.theme-rainbow{
  --surface-0:#0f1222; --surface-1:#14172a; --surface-2:#1b2036; --surface-3:#232a44;
  --text:#f1f5f9; --text-muted:#e5e7eb;
  --border:#6b7280aa; --border-soft:#6b728066;
  --primary:#a855f7; --primary-strong:#7c3aed; --accent:#22d3ee; --accent-2:#f59e0b;
  --bubble-assistant-bg:var(--surface-2);
  --bubble-assistant-borde:#a7f3d0;
  --bubble-user-bg:color-mix(in srgb, var(--primary) 18%, transparent);
  --bubble-user-borde:var(--primary-strong);
  --title-1:#ef4444; --title-2:#3b82f6; --title-3:#a855f7;

  --composer-bg: color-mix(in srgb, #1b2036 68%, #ffffff 32%);
  --composer-border: color-mix(in srgb, #7c3aed 24%, transparent);
  --composer-placeholder: color-mix(in srgb, #e5e7eb 70%, transparent);
}
body.theme-rainbow{
  background-image:
    conic-gradient(from 180deg at 50% 50%,
      #ef4444, #f59e0b, #facc15, #22c55e, #06b6d4, #3b82f6, #a855f7, #ef4444) !important;
}

/* ANIMADO: LLUVIA DE ESTRELLAS */
body.theme-starfall{
  --bg-start:#0b0b17; --bg-mid:#221a44; --bg-end:#2f1f66;
  --surface-0:#0f1021; --surface-1:#141433; --surface-2:#1b1b44; --surface-3:#232357;
  --text:#edf2ff; --text-muted:#c7d2fe;
  --border:#7c3aed77; --border-soft:#7c3aed44;
  --primary:#7c3aed; --primary-strong:#6d28d9; --accent:#22d3ee; --accent-2:#38bdf8;
  --bubble-assistant-bg:var(--surface-2); --bubble-assistant-borde:#7c3aed;
  --bubble-user-bg:color-mix(in srgb, var(--primary) 18%, transparent); --bubble-user-borde:#7c3aed;
  --title-1:#22d3ee; --title-2:#7c3aed; --title-3:#38bdf8;

  --composer-bg: color-mix(in srgb, #1b1b44 68%, #ffffff 32%);
  --composer-border: color-mix(in srgb, #7c3aed 26%, transparent);
  --composer-placeholder: color-mix(in srgb, #c7d2fe 68%, transparent);
}
body.theme-starfall{
  background-image: linear-gradient(135deg,var(--bg-start),var(--bg-mid),var(--bg-end)) !important;
}
body.theme-starfall::before{
  content:""; position: fixed; inset:-10%; pointer-events:none; z-index:-1;
  background:
    repeating-linear-gradient(120deg, transparent 0 96px, rgba(255,255,255,.06) 96px 97px, transparent 97px 180px),
    repeating-linear-gradient(120deg, transparent 0 140px, rgba(255,255,255,.10) 140px 141px, transparent 141px 260px);
  animation: starfall 30s linear infinite;
  opacity:.55; filter: blur(.3px);
}
@keyframes starfall{
  from { background-position: 0 0, 0 0; }
  to   { background-position: 0 800px, 0 1200px; }
}

/* ====== NUEVO: TEMA BLANCO MINIMALISTA (tipo ChatGPT / DeepSeek / Qwen) ====== */
body.theme-white{
  /* Fondo blanco (gradiente plano) */
  --bg-start:#ffffff; --bg-mid:#ffffff; --bg-end:#ffffff;

  /* Superficies */
  --surface-0:#ffffff;          /* chat-box */
  --surface-1:#ffffff;          /* card */
  --surface-2:#ffffff;          /* burbuja / panel base */
  --surface-3:#f2f3f5;          /* hover/contraste suave */

  /* Texto oscuro */
  --text:#111111;
  --text-muted:#475569;         /* slate-600 aprox */

  /* Bordes negros */
  --border:#000000cc;
  --border-soft:#00000040;

  /* Acentos discretos (no protagonistas) */
  --primary:#111111;            /* para evitar tintes saturados */
  --primary-strong:#000000;
  --accent:#0ea5e9;             /* sky-500 opcional */
  --accent-2:#94a3b8;           /* slate-400 */

  /* Burbujas */
  --bubble-assistant-bg:#f7f8fa;     /* "blanco invierno" */
  --bubble-assistant-borde:#000000;  /* borde negro */
  --bubble-user-bg:#ffffff;          /* blanco */
  --bubble-user-borde:#000000;       /* borde negro */

  /* Títulos (degradado muy sutil) */
  --title-1:#111111; --title-2:#222222; --title-3:#444444;

  /* Botón primario negro */
  --btn:#111111; --btn-hov:#2b2b2b;

  /* Brillos mínimos */
  --glow-1: rgba(0,0,0,.06); --glow-2: rgba(0,0,0,.04);

  /* Composer (cuadro de texto) */
  --composer-bg:#ffffff;
  --composer-border:#000000;
  --composer-text:#111111;
  --composer-placeholder:#6b7280;
}

/* Animación general al cambiar tema */
*,
*::before,
*::after{
  transition:
    background-color var(--t-dur) ease,
    color var(--t-dur) ease,
    border-color var(--t-dur) ease,
    box-shadow var(--t-dur) ease,
    filter var(--t-dur) ease,
    stroke var(--t-dur) ease,
    fill var(--t-dur) ease;
}
body{
  background-image: linear-gradient(135deg,var(--bg-start),var(--bg-mid),var(--bg-end)) !important;
  background-attachment: fixed;
  color: var(--text);
}
body.theme-anim::after{
  content:""; position: fixed; inset: 0; pointer-events: none;
  background:
    radial-gradient(1200px 650px at 70% -15%, var(--glow-1) 0%, transparent 60%),
    radial-gradient(900px 500px at 25% 120%, var(--glow-2) 0%, transparent 60%);
  opacity: 0; animation: themeOverlay 900ms ease forwards;
}
@keyframes themeOverlay{ 0%{opacity:.0} 20%{opacity:.45} 100%{opacity:0} }

/* =================== LAYOUT =================== */
:root{
  --vh: 1vh;
  --topbar-h: 0px;
  --panel-w: 320px;
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --header-h: 0px;
  --header-overlay-h: clamp(52px, 7.2vw, 72px);
  --inputbar-h: 76px;
}
html, body { height: 100%; overflow: hidden; }
#landing{
  min-height: calc((var(--vh) * 100) - var(--topbar-h));
  display: grid; grid-template-rows: 1fr !important;
  align-items: start; transition: padding-left .25s ease;
  padding-top: calc(var(--topbar-h) + var(--header-overlay-h));
  padding-bottom: calc(var(--safe-bottom) + 10px);
}
@supports (height: 100dvh){ #landing{ min-height: calc(100dvh - var(--topbar-h)); } }
#auth{ min-height: calc((var(--vh) * 100) - var(--topbar-h)); overflow: hidden; }
@supports (height: 100dvh){ #auth{ min-height: calc(100dvh - var(--topbar-h)); } }
body.panel-open #landing{ padding-left: calc(var(--panel-w) + 20px); }
@media (max-width: 640px){ body.panel-open #landing{ padding-left: 0; } }

/* =================== TÍTULOS =================== */
.hero-title{
  font-weight: 800; font-size: clamp(28px, 6.8vw, 64px); line-height: 1.05;
  background-image: linear-gradient(90deg, var(--title-1), var(--title-2), var(--title-3));
  -webkit-background-clip: text; background-clip: text; color: transparent;
}
.hero-bar{ position:absolute; top:calc(var(--topbar-h) + 6px); left:0; right:0; height:0; pointer-events:none; display:grid; place-items:center; }
.site-title-centered{
  margin:0; font-size: clamp(28px, 3.4vw, 48px); font-weight: 800; letter-spacing:.3px;
  background-image: linear-gradient(90deg, var(--title-1), var(--title-2), var(--title-3), var(--title-1));
  background-size: 300% 100%; -webkit-background-clip:text; background-clip:text; color:transparent;
  filter: drop-shadow(0 2px 10px var(--glow-1)); pointer-events:auto; animation: hue-slide 10s linear infinite;
}
@keyframes hue-slide{ 0%{background-position:0% 0} 100%{background-position:300% 0} }

/* Asistente a la derecha */
#assistant-header{ position:absolute; top:calc(var(--topbar-h) + 54px); right:clamp(20px, 8vw, 80px); z-index:30; }
.assistant-name{ margin:0; font-weight:800; letter-spacing:.2px; font-size:clamp(16px, 2.1vw, 22px); text-align:right; }
.assistant-name .mira{ font-weight:900; }
.ia-with-avatar{ position:relative; display:inline-block; padding-right:4px; }
.ia-with-avatar #avatar-mira{ position:absolute; top:120%; left:50%; transform:translateX(-50%); width:clamp(44px, 4.8vw, 62px); height:auto; filter:drop-shadow(0 2px 6px rgba(0,0,0,.25)); }

/* =================== CHAT =================== */
#main-chat{ display:flex; justify-content:center; align-items:stretch; padding:6px 12px 28px; }
.chat-wrap{ width:min(960px, 94vw); margin-inline:auto; }
#chat-card{ padding:1rem; height:100%; background:var(--surface-1)!important; border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); }
#chat-shell{
  display:flex; flex-direction:column;
  height: calc(100dvh - var(--topbar-h) - var(--header-overlay-h) - 16px) !important;
  min-height: calc(100dvh - var(--topbar-h) - var(--header-overlay-h) - 16px);
}
#chat-box{ flex:1 1 auto; overflow-y:auto; padding-bottom:calc(var(--inputbar-h) + 14px); background:var(--surface-0) !important; border-radius:10px; }

/* Composer */
.composer{
  display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center;
  position:sticky; bottom:max(10px, var(--safe-bottom));
  background: linear-gradient(180deg, rgba(0,0,0,0) 0%, color-mix(in srgb, var(--surface-1) 65%, transparent) 40%, var(--surface-1) 100%);
  padding-bottom: max(6px, var(--safe-bottom)); z-index:5;
}
.input-group{ position:relative; display:grid; align-items:center; min-width:0; }
.composer-input{
  width:100%; min-height:52px; font-size:1rem;
  background: var(--composer-bg); color: var(--composer-text);
  border:1px solid var(--composer-border); border-radius:.75rem; outline:none;
  padding:.7rem 6.2rem .7rem .8rem;
  caret-color: var(--composer-text);
}
.composer-input::placeholder{ color: var(--composer-placeholder); opacity:.95; }

/* Botón + (abre menú) */
.attach-btn{
  position:absolute; right:8px; bottom:8px; width:36px; height:36px;
  border-radius:.6rem; border:1px solid var(--border);
  background:transparent; color: var(--text); display:inline-flex; align-items:center; justify-content:center;
  cursor:pointer;
}
.attach-btn:hover{ background: var(--surface-3); }
.attach-btn .plus{ font-size:18px; line-height:1; transform: rotate(0deg); transition: transform .18s ease; display:block; }
.attach-btn[aria-expanded="true"] .plus{ transform: rotate(45deg); }

/* Micro (ahora usa color del tema) */
.mic-btn{
  position:absolute; right:52px; bottom:8px; width:36px; height:36px;
  border-radius:.6rem; border:1px solid var(--border);
  background:transparent; color: var(--text); display:inline-flex; align-items:center; justify-content:center; cursor:pointer;
}
.mic-btn:hover{ background: var(--surface-3); }
.mic-btn svg{ width:18px; height:18px; display:block; }
.mic-btn.recording{ background:#ef4444; border-color:#ef4444; color:#fff; animation: micPulse 1s ease-out infinite; }
@keyframes micPulse{ 0%{ box-shadow:0 0 0 0 rgba(239,68,68,.55)} 70%{ box-shadow:0 0 0 12px rgba(239,68,68,0)} 100%{ box-shadow:0 0 0 0 rgba(239,68,68,0)} }
.mic-btn.disabled{ opacity:.55; cursor:not-allowed; }

/* Menú adjuntar */
.upload-tray{
  position:absolute; bottom:calc(100% + .55rem); right:0;
  min-width:260px; max-width:min(420px, 92vw);
  background: var(--surface-1); border: 1px solid var(--border); border-radius:.9rem; padding:.6rem; box-shadow: var(--shadow); z-index:40;
}
.hidden{ display:none; }
.upload-item{ display:flex; align-items:center; gap:.4rem; width:100%; text-align:left; font-size:.95rem; cursor:pointer; user-select:none; color: var(--text); background:transparent; border:none; padding:.45rem .4rem; border-radius:.6rem; }
.upload-item:hover{ background: color-mix(in srgb, var(--surface-3) 70%, transparent); }

/* Enviar */
.send-btn{ border:none; background: var(--btn); color:#fff; border-radius:.6rem; padding:.45rem .6rem; font-size:.9rem; min-width:64px; }
.send-btn:hover{ background: var(--btn-hov); }

/* Burbujas */
.msg{ display:flex; gap:8px; margin:8px 0; }
.msg.assistant{ justify-content:flex-start; } .msg.user{ justify-content:flex-end; }
.bubble{ max-width:78%; padding:10px 12px; border-radius:14px; line-height:1.55; word-wrap: break-word; overflow-wrap: anywhere; box-shadow: 0 4px 10px rgba(0,0,0,.08); }
.msg.assistant .bubble{ background: var(--bubble-assistant-bg); border:1px solid var(--bubble-assistant-borde); }
.msg.user .bubble{ background: var(--bubble-user-bg); border:1px solid var(--bubble-user-borde); text-align:right; }

/* === NUEVO: animación de deslizamiento y aparición === */
.bubble.enter{ opacity:0; transform: translateX(16px) scale(.98); }
.msg.assistant .bubble.enter.from-left{ transform: translateX(-16px) scale(.98); }
.bubble.enter.show{
  opacity:1; transform: translateX(0) scale(1);
  transition: opacity .28s ease, transform .28s ease;
}

/* Markdown */
.chat-markdown pre{
  background: color-mix(in srgb, var(--surface-2) 88%, black 12%);
  border:1px solid var(--border); padding:12px 14px; border-radius:12px; overflow:auto; font-size:.96rem; margin:.5rem 0;
}
.chat-markdown table{ border-collapse: collapse; margin:.5em 0; width:100%; background: color-mix(in srgb, var(--surface-2) 85%, black 15%); color: var(--text); font-size:.97rem; }
.chat-markdown th, .chat-markdown td{ border:1px solid var(--border); padding:6px 10px; text-align:left; }
.chat-markdown th{ background: color-mix(in srgb, var(--surface-3) 75%, black 25%); }
mjx-container[jax="CHTML"]{ font-size:1.42em; background:transparent!important; padding:.12em .2em; margin:.45em 0; }

/* Pensando... */
#thinking .bubble{ font-style: italic; color: var(--text-muted); background: color-mix(in srgb, var(--surface-2) 90%, var(--accent) 10%); border: 1px dashed var(--accent); }

/* ===== Dock & Panel ===== */
.side-dock{ position:fixed; left:14px; top:50%; transform:translateY(-50%); display:flex; flex-direction:column; gap:14px; z-index:60; }
.side-dock-bottom{ position:fixed; left:14px; bottom:14px; display:flex; flex-direction:column; gap:14px; z-index:60; }
.dock-btn{ border:none; background:transparent; padding:0; display:flex; flex-direction:column; align-items:center; gap:6px; cursor:pointer; color: var(--text); filter: drop-shadow(0 0 6px var(--glow-1)); transition: transform .15s ease; }
.dock-label{ display:block; font-size:.78rem; color: var(--text-muted); letter-spacing:.2px; }
.dock-btn:hover{ transform: translateY(-2px) scale(1.04); }
.dock-icon{ width:44px; height:44px; display:grid; place-items:center; position:relative; border-radius:9999px; }
.dock-icon svg{ width:28px; height:28px; opacity:.98; }
.dock-btn.playing .dock-icon::before{ content:""; position:absolute; inset:-10px; border-radius:9999px; background: radial-gradient(closest-side, var(--glow-1), var(--glow-2) 60%, transparent 70%); filter: blur(8px); z-index:-1; animation: glowPulse 1.6s ease-in-out infinite; }
@keyframes glowPulse{ 0%{transform:scale(.95);opacity:.7} 50%{transform:scale(1.08);opacity:1} 100%{transform:scale(.95);opacity:.7} }

.side-panel{ position:fixed; top:0; left:0; height:100vh; width:var(--panel-w); background: color-mix(in srgb, var(--surface-1) 90%, transparent); border-right: 1px solid var(--border); backdrop-filter: blur(8px); transform: translateX(-100%); transition: transform .25s ease; z-index:70; padding:14px; display:flex; flex-direction:column; }
.side-panel.open{ transform: translateX(0); }
.side-panel h3{ margin:6px 0 10px; font-weight:700; }

.panel-section{ display:none; } .panel-section.active{ display:block; }
.playlist-list{ display:flex; flex-direction:column; gap:8px; margin:10px 0 12px; }
.playlist-item{ background: transparent; border: 1px dashed var(--border-soft); color: var(--text); padding: 10px; border-radius: 10px; text-align: left; cursor: pointer; }
.playlist-item:hover{ border-color: var(--border); background: color-mix(in srgb, var(--surface-3) 70%, transparent); }
.playlist-item.active{ border-color: var(--accent); background: color-mix(in srgb, var(--accent) 12%, transparent); }
.panel-iframe{ width:100%; border:1px solid var(--border-soft); border-radius:12px; height:352px; }
.close-panel{ background:transparent; border:none; color: var(--text-muted); cursor:pointer; font-size:.9rem; }

.playlist-list { overflow-y:auto; max-height: calc((var(--vh) * 100) - 420px); }
@supports (height: 100dvh){ .playlist-list{ max-height: calc(100dvh - 420px); } }

.panel-chats-header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:6px; }
.clear-all-btn{ background:transparent; border:none; color:inherit; opacity:.8; font-size:.9rem; cursor:pointer; padding:0; }
.clear-all-btn:hover{ opacity:.95; text-decoration: underline; }

/* Lista de chats */
#chat-list { position:relative; }
.chat-item{ position:relative; padding:8px 10px; border-radius:10px; transition:background .15s; }
.chat-item:hover { background: color-mix(in srgb, var(--surface-3) 60%, transparent); }
.chat-main{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
.chat-title{ display:inline-block; max-width:175px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.chat-title-btn{ background:transparent; border:none; color:inherit; cursor:pointer; padding:0; }
.kebab-btn{ border:none; background:transparent; font-size:22px; line-height:1; cursor:pointer; padding:0 4px; color: var(--text-muted); }
.kebab-btn:hover { opacity:.85; }

/* Modal acciones */
.modal.hidden{ display:none; } .modal{ position:fixed; inset:0; z-index:110; display:grid; place-items:center; }
.modal-backdrop{ position:absolute; inset:0; background: rgba(0,0,0,.55); backdrop-filter: blur(2px); }
.modal-card{ position:relative; width:min(92vw, 420px); background: var(--surface-1); border:1px solid var(--border); border-radius:14px; box-shadow: var(--shadow); padding:12px; }
.modal-card.small{ width:min(92vw, 340px); padding:10px }
.modal-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:6px; }
.modal-title{ font-weight:700; }
.modal-close{ background:transparent; border:none; color: var(--text-muted); cursor:pointer; font-size:16px; }
.modal-body{ padding:4px 4px 10px; }
.modal-chat-title{ opacity:.85; font-size:.92rem; margin:4px 2px 10px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.modal-actions{ display:grid; gap:8px; }
.modal-actions .modal-btn{ padding:9px 10px; font-size:.92rem }
.modal-btn{ width:100%; text-align:center; padding:10px 12px; border-radius:10px; border:1px solid var(--border-soft); background:var(--surface-2); color:#fff; cursor:pointer; }
.modal-btn:hover{ background: var(--surface-3); }
.modal-btn.primary{ background:var(--btn); border-color:var(--btn); color:#fff; }
.modal-btn.primary:hover{ background:var(--btn-hov); }
.modal-btn.danger{ background:#3a1025; border-color:#b91c1c; }
.modal-btn.danger:hover{ background:#4a132d; }

/* Renombrar inline */
.rename-inline{ display:flex; gap:6px; margin:6px 2px 10px }
.rename-input{
  flex:1; min-width:0; padding:8px 10px; border-radius:9px;
  border:1px solid var(--border); background:var(--surface-2); color:var(--text)
}
.rename-save, .rename-cancel{
  border:none; border-radius:9px; padding:8px 10px; cursor:pointer;
}
.rename-save{ background:var(--btn); color:#fff }
.rename-save:hover{ background:var(--btn-hov) }
.rename-cancel{ background:transparent; color:var(--text-muted) }
.rename-cancel:hover{ background:var(--surface-3) }

/* Paletas (6 swatches) */
.palette-grid{ display:flex; flex-direction:column; gap:10px; margin:8px 0 4px; }
.palette-btn{
  display:flex; align-items:center; gap:10px; width:100%; padding:10px; border-radius:10px;
  background: var(--surface-2); color:#fff; border:1px solid var(--border-soft); cursor:pointer;
}
.palette-btn:hover{ background: var(--surface-3); }
.palette-btn.active{ outline:2px solid var(--accent); }
.swatch{ width:26px; height:22px; border-radius:6px; display:inline-block; border:1px solid #ffffff20; }
.palette-btn .label{ margin-left:auto; font-size:.92rem; opacity:.9; }

/* Adjuntos (chips) */
.attachments{ display:flex; flex-wrap:wrap; gap:6px; margin-top:6px }
.attachment-chip{ display:inline-flex; align-items:center; gap:6px; background:var(--surface-2); border:1px solid var(--border); color:var(--text); border-radius:10px; padding:4px 6px; font-size:.85rem }
.attachment-chip img{ width:28px; height:28px; object-fit:cover; border-radius:6px; border:1px solid #00000030 }

/* Feedback botón adjuntar */
.attach-btn.pulse-once{ box-shadow:0 0 0 0 rgba(99,102,241,.6); animation:btnPulse .8s ease-out 1 }
@keyframes btnPulse{ 0%{box-shadow:0 0 0 0 rgba(99,102,241,.5)} 100%{box-shadow:0 0 0 16px rgba(99,102,241,0)} }

/* === Ventana flotante de adjuntos === */
.floating-attachments{
  position:absolute; top:10px; right:10px;
  width:168px; max-height:210px; padding:8px;
  background: color-mix(in srgb, var(--surface-1) 92%, transparent);
  border:1px solid var(--border); border-radius:12px;
  box-shadow: var(--shadow); z-index:66; display:none;
}
.floating-attachments.show{ display:block; }
.fa-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:6px; }
.fa-title{ font-size:.8rem; opacity:.9 }
.fa-clear{ background:transparent; border:none; color:var(--text-muted); cursor:pointer; font-size:.9rem; }
.fa-clear:hover{ color:#fff; }
.fa-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:6px; }
.fa-grid img{ width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:8px; border:1px solid var(--border); }

/* Responsive */
@media (max-width: 480px), (max-height: 640px){
  #hero-subtitle, #hero-subtitle-app { display:none; }
  .chat-wrap{ width:min(92vw, 560px); margin-inline:auto; }
  #chat-card{ padding:10px; }
  #chat-shell{ height: calc(100dvh - var(--topbar-h) - var(--header-overlay-h) - 8px) !important; }
  #chat-box{ font-size:.92rem; }
  .send-btn{ min-width:64px; padding:.45rem .6rem; font-size:.9rem; }
  .composer-input{ min-height:48px; padding-right:6.2rem; }
}
#landing.hidden{ display: none !important; }
